---
name: Auto Delete Merged Branch

# åœ¨ PR é—œé–‰æ™‚è§¸ç™¼
on:
  pull_request:
    types:
      - closed

jobs:
  delete-branch:
    # åƒ…åœ¨ PR è¢«åˆä½µï¼ˆéå–®ç´”é—œé–‰ï¼‰æ™‚åŸ·è¡Œ
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    permissions:
      contents: write
      issues: write
      pull-requests: write
    
    steps:
      - name: Delete merged branch and comment
        uses: actions/github-script@v8
        with:
          script: |
            const branchName = context.payload.pull_request.head.ref;
            const prNumber = context.payload.pull_request.number;
            
            console.log(`PR #${prNumber} å·²è¢«åˆä½µ`);
            console.log(`ä¾†æºåˆ†æ”¯: ${branchName}`);
            console.log(`ç›®æ¨™åˆ†æ”¯: ${context.payload.pull_request.base.ref}`);
            
            try {
              // åˆªé™¤é ç«¯åˆ†æ”¯
              await github.rest.git.deleteRef({
                owner: context.repo.owner,
                repo: context.repo.repo,
                ref: `heads/${branchName}`
              });
              
              console.log(`âœ… æˆåŠŸåˆªé™¤åˆ†æ”¯: ${branchName}`);
              
              // åœ¨ PR ç•™è¨€
              await github.rest.issues.createComment({
                issue_number: prNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `ğŸ‰ åˆ†æ”¯ \`${branchName}\` å·²è‡ªå‹•åˆªé™¤`
              });
            } catch (error) {
              console.log(`âš ï¸ åˆªé™¤åˆ†æ”¯å¤±æ•—æˆ–åˆ†æ”¯å·²ä¸å­˜åœ¨: ${error.message}`);
              
              // å³ä½¿åˆªé™¤å¤±æ•—ä¹Ÿç•™è¨€
              await github.rest.issues.createComment({
                issue_number: prNumber,
                owner: context.repo.owner,
                repo: context.repo.repo,
                body: `â„¹ï¸ åˆ†æ”¯ \`${branchName}\` å·²è¢«è™•ç†ï¼ˆå¯èƒ½å·²è¢«æ‰‹å‹•åˆªé™¤ï¼‰`
              });
            }
